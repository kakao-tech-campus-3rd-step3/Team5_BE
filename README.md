# 👑 DailyQ

## 1. 서비스 개요

- **서비스명**: **DailyQ**
- **목표**: 취업 준비생이 하루 5분, 하루에 하나씩 면접 질문에 답변하면서
    - **꾸준히 연습하는 습관**을 만들고
    - **AI 피드백**을 통해 부족한 점을 보완하며
    - 면접 실력을 끌어올릴 수 있게 함.
- **핵심 가치**: 무겁지 않은 '1일 1문항' 루틴 → 꾸준한 학습 → 성장 체감 → 동기 유지.

---

## 2. 문제 정의

- **취업 준비생의 학습 패턴 문제**
    - 면접 대비를 꾸준히 하고 싶지만, **매일 무엇을 준비해야 할지 체계가 없음**
    - 자기 답변을 기록하거나 피드백 받을 기회가 부족해, **자신의 성장 정도를 측정하기 어려움**
    - 혼자 공부하다 보니 지루해지고, **동기부여가 금방 떨어져 학습을 중단**하는 경우가 많음
- **기존 서비스의 한계**
    - **모의 면접(예: 사람인 AI 면접)**
        - 1회 단가가 높아 자주 이용하기 어렵고,
        - 실제 학습 루틴으로 이어지기보다는 **일회성 체험**에 머무는 경우가 많음
    - **메일 기반 학습(예: 매일메일)**
        - 사용자가 메일을 열어보지 않으면 학습이 끊김 → **사용자 주도형(passive)** 구조라 지속성이 낮음
        - 짧은 팁 위주의 정보 제공이라, **실제 답변 훈련/피드백 루프**가 부족함
- **결과적으로**
    - 취업 준비생은 **꾸준히 연습할 수 있는 가벼운 루틴**과
    - **즉각적인 피드백과 성취감을 제공하는 도구**를 찾지 못해
    - 학습 지속률이 낮고, **실질적인 역량 향상으로 이어지지 못함**

---

## 3. 솔루션

- 브라우저/앱 실행 시 **자동으로 하루 1문항 노출**
- 답변은 **텍스트/음성** 중 선택 가능 → 음성의 경우 **시간 제한 옵션** 제공
- **AI 피드백**으로 답변의 구조·명확성·근거 강화를 지원
- **아카이브/스트릭/라이벌** 기능으로 성취감·경쟁심 제공
- **꼬리 질문 기능**으로 실제 면접과 유사도 확보

---

## 4. 주요 기능

1. **회원/온보딩**
    - 소셜 로그인(구글/카카오)
    - 원하는 직군 선택 → 직군 내 세부직군 다중 선택
    - [기술 질문] / [면접 플로우 질문] 중 선택
        - [면접 플로우 질문] 선택 시: 보편적 면접 시퀀스 기반 질문 제공
    - 답변 방식(텍스트/음성), 음성의 경우 시간 제한 설정
2. **하루 질문 루틴**
    - 메인 페이지 [오늘의 질문] → 답변 입력(타자/음성)
    - 음성 답변은 자동 STT 처리
    - AI 피드백 + 사용자가 난이도 체크
    - 스트릭 증가
3. **아카이브**
    - 내가 푼 답변/피드백 히스토리
    - 즐겨찾기(핀)/난이도 필터
4. **동기 부여**
    - 스트릭(연속 기록)
    - 라이벌 지정
5. **유료 서비스**
    - (구독) 일일 질문 한도 추가
        - 면접이 임박한 사용자의 편의성 증대


---

## 5. 기술 흐름

### 5.0 회원가입 및 온보딩 플로우

신규 사용자는 소셜 로그인을 통해 간편하게 가입하고, 온보딩 과정을 통해 맞춤형 서비스를 설정합니다.

```markdown
┌─────────────┐
│   클라이언트  │
│  (브라우저)   │
└──────┬──────┘
       │ 1. 구글/카카오 로그인 버튼 클릭
       │
       │ 2. GET /oauth2/authorization/{provider}
       │    (provider: google 또는 kakao)
       │
       ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 3. OAuth2 인증 요청 리다이렉트  │   │
│  │    → 구글/카카오 인증 페이지    │   │
│  └──────┬───────────────────────┘   │
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  OAuth2 제공자 서버                   │
│  (구글 또는 카카오)                   │
│  ┌──────────────────────────────┐   │
│  │ 4. 사용자 인증 및 동의         │   │
│  │    - 이메일, 이름 등 정보 제공  │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 5. Authorization Code 반환 │
│         │    → /login/oauth2/code/{provider}│
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 6. CustomOAuth2UserService   │   │
│  │    - Authorization Code로     │   │
│  │      Access Token 교환        │   │
│  │    - 사용자 정보 API 호출      │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         ▼                            │
│  ┌──────────────────────────────┐   │
│  │ 7. 사용자 조회/생성            │   │
│  │    - 이메일로 기존 사용자 조회  │   │
│  │    - 신규: User 엔티티 생성    │   │
│  │    - 기존: 이름 업데이트        │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         ▼                            │
│  ┌──────────────────────────────┐   │
│  │ 8. 신규 사용자 초기화          │   │
│  │    - UserPreferences 생성     │   │
│  │      (기본값: TECH 모드)       │   │
│  │    - UserFlowProgress 생성    │   │
│  │      (FLOW 모드용 진행 상태)    │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         ▼                            │
│  ┌──────────────────────────────┐   │
│  │ 9. OAuth2Authentication       │   │
│  │    SuccessHandler            │   │
│  │    - Access Token 생성        │   │
│  │    - Refresh Token 생성       │   │
│  │    - Refresh Token → 쿠키 저장 │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 10. 프론트엔드로 리다이렉트  │
│         │     dailyq.my?token={accessToken}│
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  클라이언트 (프론트엔드)              │
│  ┌──────────────────────────────┐   │
│  │ 11. Access Token 저장         │   │
│  │     (로컬 스토리지/메모리)     │   │
│  │     Refresh Token은 쿠키에    │   │
│  │     자동 저장됨                │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         ▼                            │
│  ┌──────────────────────────────┐   │
│  │ 12. 온보딩 단계 진행           │   │
│  │     (신규 사용자만)            │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 12-1. PUT /api/user/jobs  │
│         │        { jobIds: [...] }   │
│         │                            │
│         │ 12-2. PUT /api/user/preferences│
│         │        {                    │
│         │          questionMode: TECH/FLOW,│
│         │          answerType: TEXT/VOICE,│
│         │          timeLimit: 60      │
│         │        }                    │
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 13. 사용자 설정 저장           │   │
│  │    - 직군 정보 업데이트         │   │
│  │    - 선호 설정 업데이트         │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 14. 설정 완료 응답          │
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  클라이언트                          │
│  ┌──────────────────────────────┐   │
│  │ 15. 메인 페이지로 이동         │   │
│  │     → 오늘의 질문 표시         │   │
│  └──────────────────────────────┘   │
└─────────────────────────────────────┘
```

**주요 단계 설명:**

1. **소셜 로그인 시작**: 사용자가 구글 또는 카카오 로그인 버튼을 클릭합니다.
2. **OAuth2 인증**: Spring Security가 OAuth2 인증 플로우를 시작하고, 사용자를 구글/카카오 인증 페이지로 리다이렉트합니다.
3. **사용자 인증**: 사용자가 구글/카카오에서 로그인하고 정보 제공에 동의합니다.
4. **사용자 정보 조회**: `CustomOAuth2UserService`가 Authorization Code를 Access Token으로 교환하고, 사용자 정보 API를 호출합니다.
5. **사용자 저장/업데이트**: 이메일로 기존 사용자를 조회하고, 없으면 신규 생성, 있으면 이름만 업데이트합니다.
6. **신규 사용자 초기화**: 신규 사용자인 경우 `UserPreferences`와 `UserFlowProgress`를 기본값으로 생성합니다.
7. **JWT 토큰 발급**: `OAuth2AuthenticationSuccessHandler`에서 Access Token과 Refresh Token을 생성합니다.
8. **토큰 저장**: Refresh Token은 HttpOnly 쿠키에 저장되고, Access Token은 URL 파라미터로 프론트엔드에 전달됩니다.
9. **온보딩 진행**: 신규 사용자는 직군 선택, 질문 모드 선택, 답변 방식 설정을 진행합니다.
10. **서비스 이용 시작**: 온보딩 완료 후 메인 페이지에서 오늘의 질문을 받아 답변을 시작할 수 있습니다.

**토큰 갱신 플로우:**
- Access Token 만료 시: `POST /api/token/refresh`로 Refresh Token을 사용해 새로운 Access Token 발급
- Refresh Token은 쿠키에서 자동으로 읽어옴

---

### 5.1 음성 답변 플로우

음성 답변의 경우 비동기 STT 처리와 실시간 알림을 통해 사용자 경험을 최적화합니다.

```
┌─────────────┐
│   클라이언트  │
│  (브라우저)   │
└──────┬──────┘
       │ 1. 음성 녹음
       │
       ▼
┌─────────────────────────────────────┐
│ 2. GET /api/answers/upload-url      │
│    (Presigned URL 요청)             │
└──────┬──────────────────────────────┘
       │
       │ 3. Presigned URL 반환
       │
       ▼
┌─────────────────────────────────────┐
│ 4. 음성 파일을 NCP Object Storage에  │
│    직접 업로드 (Presigned URL 사용)  │
└──────┬──────────────────────────────┘
       │
       │ 5. POST /api/answers
       │    { questionId, audioUrl, ... }
       │
       ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 6. Answer 엔티티 생성        │   │
│  │    - answerText: null       │   │
│  │    - sttStatus: PENDING      │   │
│  │    - feedback: PENDING       │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         ▼                            │
│  ┌──────────────────────────────┐   │
│  │ 7. SttTask 생성 및            │   │
│  │    NCP CLOVA STT API 호출     │   │
│  │    (비동기 작업 시작)          │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 8. AnswerInfoResponse 반환 │
│         │    { answerId, status: ... }│
└─────────┼────────────────────────────┘
          │
          │ 9. SSE 연결 (GET /api/sse/connect)
          │
          ▼
┌─────────────────────────────────────┐
│  클라이언트 (SSE 연결 대기)           │
└─────────────────────────────────────┘

       [비동기 처리 진행 중...]

┌─────────────────────────────────────┐
│  NCP CLOVA STT                      │
│  ┌──────────────────────────────┐   │
│  │ 10. 음성 파일 분석            │   │
│  │ 11. 텍스트 변환 완료           │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 12. POST /api/stt/callback │
│         │     { sttTaskId, text, ... }│
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 13. SttCallbackService       │   │
│  │     - SttTask 상태 업데이트     │   │
│  │     - Answer 텍스트 업데이트     │   │
│  │     - SttCompletedEvent 발행  │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         ▼                            │
│  ┌──────────────────────────────┐   │
│  │ 14. FeedbackService          │   │
│  │     - OpenAI GPT API 호출     │   │
│  │     - 피드백 생성 (비동기)       │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 15. SSE 이벤트 발송        │
│         │     - stt_completed        │
│         │     - feedback_ready      │
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  클라이언트 (SSE 이벤트 수신)         │
│  ┌──────────────────────────────┐   │
│  │ 16. 실시간 알림 수신             │   │
│  │     - STT 완료 알림            │   │
│  │     - 피드백 준비 완료 알림       │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 17. GET /api/answers/{id}  │
│         │                            │
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 18. AnswerDetailResponse 반환 │   │
│  │     - answerText (STT 결과)   │   │
│  │     - feedback (AI 피드백)    │   │
│  │     - question 정보           │   │
│  └──────────────────────────────┘   │
└─────────────────────────────────────┘
```

**주요 단계 설명:**

1. **음성 녹음**: 사용자가 브라우저에서 음성을 녹음합니다.
2. **Presigned URL 요청**: 클라이언트가 서버에 업로드용 Presigned URL을 요청합니다.
3. **직접 업로드**: 클라이언트가 Presigned URL을 사용해 NCP Object Storage에 음성 파일을 직접 업로드합니다. (서버 부하 감소)
4. **답변 등록**: 음성 파일 URL과 함께 `/api/answers` 엔드포인트로 답변을 등록합니다.
5. **Answer 생성**: 서버에서 Answer 엔티티를 생성하지만, 아직 텍스트는 없고 STT 상태는 `PENDING`입니다.
6. **STT 작업 시작**: `SttTask`를 생성하고 NCP CLOVA STT API를 호출하여 비동기 변환 작업을 시작합니다.
7. **SSE 연결**: 클라이언트가 `/api/sse/connect`로 SSE 연결을 수립하여 실시간 알림을 받을 준비를 합니다.
8. **STT 콜백 처리**: NCP CLOVA가 변환을 완료하면 `/api/stt/callback`으로 콜백을 보냅니다.
9. **텍스트 업데이트**: 콜백에서 받은 텍스트로 Answer를 업데이트하고 `SttCompletedEvent`를 발행합니다.
10. **AI 피드백 생성**: `FeedbackService`가 OpenAI GPT API를 호출하여 피드백을 생성합니다. (비동기)
11. **실시간 알림**: SSE를 통해 클라이언트에 `stt_completed`, `feedback_ready` 이벤트를 전송합니다.
12. **결과 조회**: 클라이언트가 `/api/answers/{id}`로 최종 답변과 피드백을 조회합니다.

**에러 처리:**
- STT 실패 시: `SttFailedEvent` 발행 → SSE로 알림 → 클라이언트가 `/api/answers/{id}/retry-stt`로 재시도 가능
- 피드백 생성 실패 시: Feedback 상태를 `FAILED`로 업데이트 → 재시도 가능

---

### 5.2 텍스트 답변 플로우

텍스트 답변은 더 단순한 동기 플로우를 따릅니다.

```
┌─────────────┐
│   클라이언트  │
└──────┬──────┘
       │ 1. 텍스트 입력
       │
       │ 2. POST /api/answers
       │    { questionId, answerText, ... }
       │
       ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 3. Answer 엔티티 생성         │   │
│  │    - answerText: 입력된 텍스트 │   │
│  │    - sttStatus: N/A          │   │
│  │    - feedback: PENDING       │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         ▼                            │
│  ┌──────────────────────────────┐   │
│  │ 4. Feedback 생성 (PENDING)   │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 5. AnswerInfoResponse 반환 │
│         │    { answerId, status: ... }│
└─────────┼────────────────────────────┘
          │
          │ 6. SSE 연결 (GET /api/sse/connect)
          │
          ▼
┌─────────────────────────────────────┐
│  클라이언트 (SSE 연결 대기)           │
└─────────────────────────────────────┘

       [비동기 처리 진행 중...]

┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 7. FeedbackService           │   │
│  │     - OpenAI GPT API 호출     │   │
│  │     - 피드백 생성 (비동기)     │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 8. SSE 이벤트 발송         │
│         │     - feedback_ready       │
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  클라이언트 (SSE 이벤트 수신)         │
│  ┌──────────────────────────────┐   │
│  │ 9. 실시간 알림 수신            │   │
│  │     - 피드백 준비 완료 알림     │   │
│  └──────┬───────────────────────┘   │
│         │                            │
│         │ 10. GET /api/answers/{id}  │
│         │                            │
└─────────┼────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ 11. AnswerDetailResponse 반환 │   │
│  │     - answerText             │   │
│  │     - feedback (AI 피드백)    │   │
│  │     - question 정보           │   │
│  └──────────────────────────────┘   │
└─────────────────────────────────────┘
```

**주요 차이점:**
- STT 단계가 없어 더 빠른 처리
- Answer 생성 시점에 이미 텍스트가 포함됨
- 피드백 생성만 비동기로 처리

---

### 5.3 상태 조회 플로우

클라이언트는 주기적으로 또는 SSE 이벤트 수신 후 상태를 확인할 수 있습니다.

```
┌─────────────┐
│   클라이언트  │
└──────┬──────┘
       │
       │ GET /api/answers/{id}/status
       │
       ▼
┌─────────────────────────────────────┐
│  Spring Boot 서버                    │
│  ┌──────────────────────────────┐   │
│  │ AnswerInfoResponse 반환       │   │
│  │ {                             │   │
│  │   answerId,                   │   │
│  │   sttStatus: COMPLETED,       │   │
│  │   feedbackStatus: DONE,       │   │
│  │   ...                         │   │
│  }                               │   │
│  └──────────────────────────────┘   │
└─────────────────────────────────────┘
```

**상태 값:**
- `sttStatus`: `PENDING` → `COMPLETED` / `FAILED`
- `feedbackStatus`: `PENDING` → `PROCESSING` → `DONE` / `FAILED`

---

### 5.4 전체 아키텍처 다이어그램

```markdown
                    ┌──────────────┐
                    │   클라이언트   │
                    │ (React/Chrome)│
                    └──────┬───────┘
                           │
                           │ HTTP/SSE
                           │
        ┌──────────────────┴──────────────────┐
        │                                     │
        ▼                                     ▼
┌───────────────┐                    ┌───────────────┐
│  Spring Boot  │                    │  NCP Object   │
│    서버        │                    │   Storage     │
│               │                    │               │
│ ┌───────────┐ │                    │  (음성 파일)   │
│ │ Answer    │ │                    └───────────────┘
│ │ Service   │ │
│ └─────┬─────┘ │                    ┌───────────────┐
│       │       │                    │  NCP CLOVA    │
│ ┌─────▼─────┐ │                    │     STT      │
│ │ STT Task  │◄┼────────────────────┤               │
│ │ Service   │ │   API 호출/콜백    │  (음성→텍스트) │
│ └─────┬─────┘ │                    └───────────────┘
│       │       │
│ ┌─────▼─────┐ │                    ┌───────────────┐
│ │ Feedback  │ │                    │   OpenAI      │
│ │ Service   │◄┼────────────────────┤     GPT       │
│ └─────┬─────┘ │   API 호출         │  (피드백 생성)  │
│       │       │                    └───────────────┘
│ ┌─────▼─────┐ │
│ │   MySQL   │ │
│ │  Database │ │
│ └───────────┘ │
└───────────────┘
```

**주요 컴포넌트:**
- **클라이언트**: React 기반 웹앱 또는 Chrome Extension
- **Spring Boot 서버**: 비즈니스 로직 처리 및 API 제공
- **NCP Object Storage**: 음성 파일 저장소
- **NCP CLOVA STT**: 음성을 텍스트로 변환
- **OpenAI GPT**: 답변에 대한 AI 피드백 생성
- **MySQL**: Answer, Feedback, Question 등 데이터 영구 저장

---

## 6. 기술 스택

- **프런트엔드**: React (TypeScript), Chrome Extension
- **백엔드**: Spring Boot, JWT 인증
- **DB**: MySQL 8.x (InnoDB)
- **AI 연동**: STT API(네이버 CLOVA) 기반 음성 변환, LLM(OpenAI) 기반 피드백
- **배포**: Docker

---

## 7. 기대 효과

- **사용자**: 매일 꾸준한 연습 → 성장 체감 → 동기 유지 → 취업 성공 확률↑
- **운영자**: 데이터 축적(답변/난이도/자소서) → AI 학습 자원 확보 → 서비스 고도화
- **시장 경쟁력**: 기존 모의면접 대비 가볍고, 메일 기반 대비 강제성이 있는 '데일리 루틴' 차별화

---

## 8. 추후 로드맵

- **멀티모달 피드백**
    - 현재는 텍스트 위주의 피드백 → **톤 분석**까지 확장
    - 음성 데이터를 기반으로 **태도·목소리 안정성**까지 분석
- **자소서 기반 맞춤 질문 생성**
    - 사용자 자소서 업로드 → N개 핵심 문장 추출 → 직군/기업 컨텍스트로 질문 생성